generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Cliente {
  id           Int      @id @default(autoincrement())
  nome         String   @unique
  apelido      String?
  telefone     String?
  dataNascimento DateTime?
  cidade       String?    // Novo: cidade (ex: "São Paulo")
  bairro       String?    // Novo: bairro (ex: "Centro")
  rua          String?    // Novo: rua (ex: "Av. Paulista, 123")
  ultimaCompra     DateTime? // Novo: data da última compra (opcional)
  frequenciaCompras Int?     // Novo: número total de compras (opcional)
  vendas       Venda[]
  criadoEm     DateTime @default(now())
}

model Venda {
  id                   Int      @id @default(autoincrement())
  produtoId            Int
  quantidade           Int
  precoVenda           Float
  valorTotal           Float
  entrada              Float    @default(0)
  formaPagamentoEntrada String?  // Novo campo: 'DINHEIRO', 'PIX', etc. para entrada
  clienteId            Int
  observacao           String?
  dataVenda            DateTime
  formaPagamento       String?   // Ex.: 'DINHEIRO', 'PIX', 'CARTAO_VISA_DEBITO', 'PROMISSORIA'
  taxa                 Float?    @default(0)
  valorLiquido         Float?    @default(0)
  status               String   @default("ABERTO")
  createdAt            DateTime @default(now())
  produto              Produto  @relation(fields: [produtoId], references: [id])
  cliente              Cliente  @relation(fields: [clienteId], references: [id])
  parcelas             Parcela[]
}

model Parcela {
  id             Int      @id @default(autoincrement())
  vendaId        Int
  numeroParcela  Int
  valor          Float
  valorPago      Float    @default(0)
  dataVencimento DateTime
  dataPagamento  DateTime? // Data quando foi pago
  pago           Boolean  @default(false)
  observacao     String?
  formaPagamento String?   // Ex.: 'DINHEIRO', 'PIX', 'CARTAO_VISA_DEBITO'
  taxa           Float?    @default(0) // Taxa em reais (ex.: 4.99)
  valorLiquido   Float?    @default(0) // Valor após taxa (ex.: 95.01)
  venda          Venda    @relation(fields: [vendaId], references: [id])
}

model Produto {
  id               Int      @id @default(autoincrement())
  nome             String
  tamanho          Int
  referencia       String?
  cor              String
  quantidade       Int
  precoCusto       Float?   @default(0.0) // Novo: opcional, default 0
  precoVenda       Float    // Novo: obrigatório, substitui preco
  imagem           String?  // Novo: opcional, para URL da imagem
  genero           String?
  modelo           String?
  marca            String?
  disponivel       Boolean  @default(true)
  vendas           Venda[]
  lote             String?
  dataRecebimento  DateTime

  createdAt       DateTime @default(now())
}

enum Role {
  ADMIN
  FUNCIONARIO
}

model User {
  id        String   @id @default(cuid())
  name      String   @unique
  password  String
  role      Role     @default(FUNCIONARIO)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model TaxaCartao {
  id            Int      @id @default(autoincrement())
  bandeira      String
  modalidade    String
  taxaPercentual Float

  historico     TaxaCartaoHistorico[] @relation("TaxaCartaoHistorico")

  @@unique([bandeira, modalidade])
}

model TaxaCartaoHistorico {
  id            Int      @id @default(autoincrement())
  taxaCartaoId  Int
  bandeira      String
  modalidade    String
  taxaAntiga    Float
  taxaNova      Float
  alteradoPor   String?
  alteradoEm    DateTime @default(now())

  taxaCartao    TaxaCartao @relation("TaxaCartaoHistorico", fields: [taxaCartaoId], references: [id])
}

// ENUMS
enum BandeiraCartao {
  VISA
  MASTERCARD
  ELO
  CIELO
}

enum ModalidadeCartao {
  DEBITO
  CREDITO_X1
  CREDITO_X2
  CREDITO_X3
  CREDITO_X4
  CREDITO_X5
  CREDITO_X6
}