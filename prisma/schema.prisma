generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

enum Genero {
  MASCULINO
  FEMININO
  INFANTIL_MASCULINO
  INFANTIL_FEMININO
}

enum Modelo {
  TENIS
  SAPATENIS
  SANDALIA
  RASTEIRA
  TAMANCO
  SCARPIN
  BOTA
  CHINELO
  MOCASSIM
  PAPETE
  CHUTEIRA
}

model Cliente {
  id           Int      @id @default(autoincrement())
  nome         String   @unique
  apelido      String?
  telefone     String?
  ultimaCompra     DateTime? // Novo: data da última compra (opcional)
  frequenciaCompras Int?     // Novo: número total de compras (opcional)
  vendas       Venda[]
  criadoEm     DateTime @default(now())
}

model Venda {
  id                   Int      @id @default(autoincrement())
  produtoId            Int
  quantidade           Int
  precoVenda           Float
  valorTotal           Float
  entrada              Float    @default(0)
  formaPagamentoEntrada String?  // Novo campo: 'DINHEIRO', 'PIX', etc. para entrada
  clienteId            Int
  observacao           String?
  dataVenda            DateTime
  formaPagamento       String?   // Ex.: 'DINHEIRO', 'PIX', 'CARTAO_VISA_DEBITO', 'PROMISSORIA'
  taxa                 Float?    @default(0)
  valorLiquido         Float?    @default(0)
  status               String   @default("ABERTO")
  createdAt            DateTime @default(now())
  produto              Produto  @relation(fields: [produtoId], references: [id])
  cliente              Cliente  @relation(fields: [clienteId], references: [id])
  parcelas             Parcela[]
}

model Parcela {
  id             Int      @id @default(autoincrement())
  vendaId        Int
  numeroParcela  Int
  valor          Float
  valorPago      Float    @default(0)
  dataVencimento DateTime
  dataPagamento  DateTime? // Data quando foi pago
  pago           Boolean  @default(false)
  observacao     String?
  formaPagamento String?   // Ex.: 'DINHEIRO', 'PIX', 'CARTAO_VISA_DEBITO'
  taxa           Float?    @default(0) // Taxa em reais (ex.: 4.99)
  valorLiquido   Float?    @default(0) // Valor após taxa (ex.: 95.01)
  venda          Venda    @relation(fields: [vendaId], references: [id])
}

model Produto {
  id               Int      @id @default(autoincrement())
  nome             String
  tamanho          Int
  referencia       String?
  cor              String
  quantidade       Int
  preco            Float
  genero           String?
  modelo           String?
  marca            String?
  disponivel       Boolean  @default(true)
  vendas           Venda[]
  lote             String?
  dataRecebimento  DateTime
}

model TaxaCartao {
  id             Int     @id @default(autoincrement())
  bandeira       String  // Ex.: 'VISA', 'MASTERCARD', 'ELO'
  modalidade     String  // Ex.: 'DEBITO', 'CREDITO_A_VISTA', '2_3X', '4_6X'
  taxaPercentual Float   // Ex.: 1.99 para 1,99%
  @@unique([bandeira, modalidade]) // Evita duplicatas
}